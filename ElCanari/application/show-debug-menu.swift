//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//  Created by Pierre Molinaro on 14/06/2021.
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

import AppKit

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   Public function
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

@MainActor func instanciateDebugMenuVisibilityObjectOnDidFinishLaunchingNotification () {
  gDebugMenuVisibility = DebugMenuVisibility ()
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   Private entities
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

@MainActor fileprivate var gDebugMenuVisibility : DebugMenuVisibility? = nil

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

@MainActor fileprivate final class DebugMenuVisibility {

  //····················································································································
  //  Property
  //····················································································································

  private var mDebugMenuItem = NSMenuItem (title: "Debug", action: nil, keyEquivalent: "")
  private var mShowMenuController : EBObservablePropertyController? = nil

  //····················································································································
  //  Init
  //····················································································································

  init () {
    let menu = NSMenu (title: "Debug")
    self.mDebugMenuItem.submenu = menu
    self.mShowMenuController = EBObservablePropertyController (
      observedObjects: [preferences_showDebugMenu_property],
      callBack: { [weak self] in self?.updateDebugMenuVisibility () }
    )
    appendAllocationDebugMenuItems (menu)
    appendShowTransientEventLogWindowMenuItem (menu)
    appendShowDocumentFileOperationDurationWindowMenuItem (menu)
    appendDebugAutoLayoutMenuItem (menu)
  }

  //····················································································································

  func updateDebugMenuVisibility () {
    if let mainMenu = NSApplication.shared.mainMenu {
      if preferences_showDebugMenu_property.propval {
        mainMenu.addItem (mDebugMenuItem)
      }else if mainMenu.index (of: mDebugMenuItem) >= 0 {
        mainMenu.removeItem (mDebugMenuItem)
      }
    }
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
