//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//
//  AutoLayoutColorWell.swift
//
//  Created by Pierre Molinaro on 10/02/2021.
//
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

import Cocoa

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

final class AutoLayoutColorWell : NSColorWell, EBUserClassNameProtocol {

  //····················································································································

  init () {
    super.init (frame: .zero)
    noteObjectAllocation (self)
    self.translatesAutoresizingMaskIntoConstraints = false

    self.setContentCompressionResistancePriority (.required, for: .horizontal)
    self.setContentCompressionResistancePriority (.required, for: .vertical)

    self.target = self
    self.action = #selector (Self.action(_:))
  }

  //····················································································································

  required init? (coder : NSCoder) {
    fatalError ("init(coder:) has not been implemented")
  }

  //····················································································································

  deinit {
    noteObjectDeallocation (self)
  }

  //····················································································································

  @objc func action (_ sender : AutoLayoutColorWell) {
    _ = self.mColorController?.updateModel(withCandidateValue: self.color, windowForSheet: self.window)
  }


  //····················································································································

  override var intrinsicContentSize : NSSize {
    return NSSize (width: 40, height: 20)
  }

  //····················································································································
  //  $enabled binding
  //····················································································································

  private var mEnabledBindingController : EnabledBindingController? = nil
  var enabledBindingController : EnabledBindingController? { return self.mEnabledBindingController }

  //····················································································································

  final func bind_enabled (_ inExpression : EBMultipleBindingBooleanExpression) -> Self {
    self.mEnabledBindingController = EnabledBindingController (inExpression, self)
    return self
  }

  //····················································································································
  //  color binding
  //····················································································································

  fileprivate func updateColor (from inObject : EBReadOnlyProperty_NSColor) {
    switch inObject.selection {
    case .empty, .multiple :
      self.enable (fromValueBinding: false, self.enabledBindingController)
    case .single (let v) :
      self.enable (fromValueBinding: true, self.enabledBindingController)
      self.color = v
    }
  }

  //····················································································································

  private var mColorController : EBGenericReadWritePropertyController <NSColor>? = nil
  var mSendContinously = false

  //····················································································································

  final func bind_color (_ inObject : EBReadWriteProperty_NSColor, sendContinously : Bool) -> Self {
    NSColorPanel.shared.showsAlpha = true
    self.mSendContinously = sendContinously
    self.mColorController = EBGenericReadWritePropertyController <NSColor> (
      observedObject: inObject,
      callBack: { [weak self] in self?.updateColor (from: inObject)  }
    )
    return self
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
