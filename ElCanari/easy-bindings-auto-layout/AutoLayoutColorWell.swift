//——————————————————————————————————————————————————————————————————————————————————————————————————
//
//  AutoLayoutColorWell.swift
//
//  Created by Pierre Molinaro on 10/02/2021.
//
//——————————————————————————————————————————————————————————————————————————————————————————————————
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//——————————————————————————————————————————————————————————————————————————————————————————————————

import AppKit

//——————————————————————————————————————————————————————————————————————————————————————————————————

final class AutoLayoutColorWell : NSColorWell {

  //····················································································································

  init () {
    super.init (frame: .zero)
    noteObjectAllocation (self)
    self.translatesAutoresizingMaskIntoConstraints = false

    self.setContentCompressionResistancePriority (.required, for: .horizontal)
    self.setContentCompressionResistancePriority (.required, for: .vertical)

    self.target = self
    self.action = #selector (Self.action(_:))
  }

  //····················································································································

  required init? (coder : NSCoder) {
    fatalError ("init(coder:) has not been implemented")
  }

  //····················································································································

  deinit {
    noteObjectDeallocation (self)
  }

  //····················································································································

  @objc func action (_ sender : AutoLayoutColorWell) {
    self.mColorController?.updateModel (withValue: self.color)
  }

  //····················································································································

  override var intrinsicContentSize : NSSize {
    return NSSize (width: 40, height: 20)
  }

  //····················································································································

  func set (toolTip inToolTip : String) -> Self {
    self.toolTip = inToolTip
    return self
  }

  //····················································································································
  //MARK:  $enabled binding
  //····················································································································

  private var mEnabledBindingController : EnabledBindingController? = nil

  //····················································································································

  final func bind_enabled (_ inExpression : EBMultipleBindingBooleanExpression) -> Self {
    self.mEnabledBindingController = EnabledBindingController (inExpression, self)
    return self
  }

  //····················································································································
  //  color binding
  //····················································································································

  fileprivate func updateColor (from inObject : EBObservableProperty <NSColor>) {
    switch inObject.selection {
    case .empty, .multiple :
      self.enable (fromValueBinding: false, self.mEnabledBindingController)
    case .single (let v) :
      self.enable (fromValueBinding: true, self.mEnabledBindingController)
      self.color = v
    }
  }

  //····················································································································

  private var mColorController : EBGenericReadWritePropertyController <NSColor>? = nil

  //····················································································································

  final func bind_color (_ inObject : EBObservableMutableProperty <NSColor>) -> Self {
    NSColorPanel.shared.showsAlpha = true
    self.mColorController = EBGenericReadWritePropertyController <NSColor> (
      observedObject: inObject,
      callBack: { [weak self] in self?.updateColor (from: inObject)  }
    )
    return self
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————
