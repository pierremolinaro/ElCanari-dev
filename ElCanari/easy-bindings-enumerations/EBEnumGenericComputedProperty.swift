//——————————————————————————————————————————————————————————————————————————————————————————————————
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//——————————————————————————————————————————————————————————————————————————————————————————————————

import AppKit

//——————————————————————————————————————————————————————————————————————————————————————————————————
//   EBEnumGenericComputedProperty <T : EnumPropertyProtocol>
//——————————————————————————————————————————————————————————————————————————————————————————————————

final class EBEnumGenericComputedProperty <T : EBEnumPropertyProtocol> : EBEnumReadWriteProperty <T> {

  //····················································································································

  var mReadModelFunction : Optional < () -> EBSelection <T> > = nil
  var mWriteModelFunction : Optional < (T) -> Void > = nil
  private var mCachedValue : Optional < EBSelection <T> > = nil

  //····················································································································

  override func observedObjectDidChange () {
    if self.mCachedValue != nil {
      self.mCachedValue = nil
      if logEvents () {
        appendMessageString ("Proxy #\(self.objectIndex) propagation\n")
      }
      super.observedObjectDidChange ()
    }else if logEvents () {
      appendMessageString ("Proxy #\(self.objectIndex) nil\n")
    }
  }

  //····················································································································

  override var selection : EBSelection <T> {
    if let cachedValue = self.mCachedValue {
      return cachedValue
    }else{
      self.mCachedValue = self.mReadModelFunction? ()
      if let cachedValue = self.mCachedValue {
        return cachedValue
      }else{
        self.mCachedValue = .empty
        return .empty
      }
    }
  }

  //····················································································································

  override func setProp (_ inValue : T) {
    self.mWriteModelFunction? (inValue)
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————
