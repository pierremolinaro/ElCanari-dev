//--------------------------------------------------------------------------------------------------
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//--------------------------------------------------------------------------------------------------

import AppKit

//--------------------------------------------------------------------------------------------------
//   EBComputedProperty <T>
//--------------------------------------------------------------------------------------------------

final class EBComputedProperty <T> : EBObservableMutableProperty <T> {

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

  private var mValueCache : EBSelection <T>? = nil
  var mReadModelFunction : Optional < () -> EBSelection <T> > = nil
  var mWriteModelFunction : Optional < (_ inValue : T) -> Void > = nil

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

  override var selection : EBSelection <T> {
    if let value = self.mValueCache {
      return value
    }else{
      self.mValueCache = self.mReadModelFunction? ()
      if let value = self.mValueCache {
        return value
      }else{
        self.mValueCache = .empty
        return .empty
      }
    }
  }

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

  override func observedObjectDidChange () {
    if self.mValueCache != nil {
      self.mValueCache = nil
      if logEvents () {
        appendMessage ("Transient #\(self.objectIndex) propagation\n")
      }
      super.observedObjectDidChange ()
    }else if logEvents () {
      appendMessage ("Transient #\(self.objectIndex) nil\n")
    }
  }

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

  override func setProp (_ inValue : T) {
    self.mWriteModelFunction? (inValue)
  }

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

}

//--------------------------------------------------------------------------------------------------
