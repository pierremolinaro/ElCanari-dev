//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

import Cocoa

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   EBGenericTransientProperty <T>
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class EBGenericTransientProperty <T : Equatable> : EBObservableProperty <T>, EBObserverProtocol {

  //····················································································································

  private final var mValueCache : EBSelection <T>? = nil
  final var mReadModelFunction : Optional<() -> EBSelection <T> > = nil

  //····················································································································

  #if BUILD_OBJECT_EXPLORER
    final var mValueExplorer : NSTextField? {
      didSet {
        if let valueCache = self.mValueCache {
          self.mValueExplorer?.stringValue = "\(valueCache)"
        }else{
          self.mValueExplorer?.stringValue = "nil"
        }
      }
    }
  #endif

  //····················································································································

  override final var selection : EBSelection <T> {
    if self.mValueCache == nil {
      self.mValueCache = self.mReadModelFunction? ()
      if self.mValueCache == nil {
        self.mValueCache = .empty
      }
      #if BUILD_OBJECT_EXPLORER
        self.mValueExplorer?.stringValue = "\(self.mValueCache!)"
      #endif
    }
    return self.mValueCache!
  }

  //····················································································································

  override final func observedObjectDidChange () {
    if self.mValueCache != nil {
      self.mValueCache = nil
      #if BUILD_OBJECT_EXPLORER
        self.mValueExplorer?.stringValue = "nil"
      #endif
      if logEvents () {
       appendMessageString ("Transient \(self.explorerIndexString) propagation\n")
      }
      super.observedObjectDidChange ()
    }else if logEvents () {
      appendMessageString ("Transient \(self.explorerIndexString) nil\n")
    }
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
