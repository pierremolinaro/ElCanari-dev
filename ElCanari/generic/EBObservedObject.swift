//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

import Cocoa

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   EBObservedObject
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class EBObservedObject : EBSwiftBaseObject {

  //····················································································································

  private final var mObservers = EBWeakEventSet ()

  //····················································································································

  final func addEBObserver (_ inObserver : EBObserverProtocol) {
    self.mObservers.insert (inObserver)
    #if BUILD_OBJECT_EXPLORER
      self.updateObserverExplorer ()
    #endif
    inObserver.observedObjectDidChange ()
  }

  //····················································································································

  final func removeEBObserver (_ inObserver : EBObserverProtocol) {
    self.mObservers.remove (inObserver)
    #if BUILD_OBJECT_EXPLORER
      self.updateObserverExplorer ()
    #endif
  }

  //····················································································································

  func observedObjectDidChange () {
    for (_, entry) in self.mObservers.dictionary {
      if let observer = entry.observer {
        observer.observedObjectDidChange ()
      }else{
        self.mObservers.triggerPacking ()
      }
    }
  }

  //····················································································································

  #if BUILD_OBJECT_EXPLORER
    final var mObserverExplorer : NSPopUpButton? {
      didSet {
        self.updateObserverExplorer ()
      }
    }
  #endif

  //····················································································································

  #if BUILD_OBJECT_EXPLORER
    final func updateObserverExplorer () {
      if let observerExplorer = self.mObserverExplorer {
        observerExplorer.removeAllItems ()
        var observerCount = 0
        for (_, entry) in self.mObservers.dictionary {
          if entry.observer != nil {
            observerCount += 1
          }
        }
        observerExplorer.addItem (withTitle: String (observerCount))
        observerExplorer.isEnabled = observerCount > 0
        for (_, entry) in self.mObservers.dictionary {
          if let observer = entry.observer {
            let stringValue = explorerObjectIndexString (observer.objectIndex) + " - " + String (describing: type (of: observer))
            observerExplorer.addItem (withTitle: stringValue)
          }else{
            self.mObservers.triggerPacking ()
          }
        }
      }
    }
  #endif

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
